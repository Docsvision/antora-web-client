= Справочник полномочий для доверенностей

Справочник предназначен для хранения кодов полномочий для машиночитаемых доверенностей.

.Справочник полномочий для доверенностей
image::powers-directory.png[Справочник полномочий для доверенностей]

Справочник доступен по адресу: `\http://адрес-сервера-Web-клиента/DocsvisionWebClient/#/DirectoryView/30EB75E2-16F8-4150-A2D4-4A82A38A1849`, ссылка на справочник полномочий также добавлена в разметку _Основного меню_ в базовом решении.

В левой области справочника отображается вкладка _Справочники_. Это список справочников кодов полномочий, отсортированный в алфавитном порядке. Коды полномочий отображаются в формате `Код полномочий Полномочия`. При необходимости полномочия можно найти при помощи поиска по справочнику.

[#structure]
== Структура справочника

// tag::descr[]
.Справочник представляет собой двухуровневую иерархическую структуру:
* На первом уровне справочника представлен список справочников полномочий.
* В каждом справочнике представлены коды полномочий.
// end::descr[]

Отредактировать справочник или код полномочий можно, выбрав в контекстном меню команды _Изменить код полномочий_ или _Изменить справочник_, а также при помощи кнопки image:buttons/blue-pencil.png[Белый карандаш в синем круге].

[#new-list]
=== Добавление нового справочника

Добавить справочник кодов в список можно, выбрав в контекстном меню узла _Справочник кодов полномочий_ команду _Создать справочник_, или выбрать корневой узел, нажать кнопку image:buttons/blue-plus.png[Белый плюс в синем круге], выбрать *Добавить справочник*.

.Создание нового справочника полномочий
image::new-powers.png[Создание нового справочника полномочий]

.Появится всплывающее окно с полями для добавления нового справочника:
. _Название справочника_ -- удобочитаемое название справочника. Поле обязательно для заполнения.
. _Код справочника_ -- уникальный код справочника полномочий. Поле обязательно для заполнения.
. _Составитель (группа)_ -- пользователь или группа составителей справочника. Поле обязательно для заполнения.
. _Идентификатор составителя в ЕСНСИ_ -- необходим при <импорте полномочий из ЕСНСИ. Идентификатор в справочнике сравнивается с идентификатором в XML-файле ЕСНСИ. В зависимости от результата сравнения полномочия будут импортированы или помечены неактивными. См. подробнее ниже, в разделе <<import-list,Импорт справочника из ЕСНСИ>>.

.Информация о справочнике кодов полномочий
image::powers-info.png[Информация о справочнике кодов полномочий]

Информацию о справочнике кодов полномочий можно изменить, выбрав код в списке слева и нажав кнопку image:buttons/blue-pencil.png[Белый карандаш в синем круге].

[#import-list]
=== Импорт справочника из ЕСНСИ

Система позволяет импортировать полномочия из ЕСНСИ  через загрузку данных из xml-файла. Поддерживается импорт только из справочника по адресу https://esnsi.gosuslugi.ru/classifiers/6714/data?pg=1&p=1.

. Импортировать полномочия в список можно, выбрав в контекстном меню узла _Справочник кодов полномочий_ команду _Импортировать полномочия_, или выбрать корневой узел, нажать кнопку image:buttons/blue-plus.png[Белый плюс в синем круге], выбрать *Импортировать полномочия*.
. При нажатии на кнопку *Импортировать полномочия* открывается диалоговое окно для выбора xml-файла с полномочиями из файловой системы.
. После выбора XML-файла будет выполнен импорт полномочий.
+
Во время импорта будет выполнена проверка существования полномочий по Идентификатору составителя в ЕСНСИ.
+
* Если в XML-файле нет кода полномочий, соответствующего Идентификатору составителя в ЕСНСИ, группа в справочнике не обрабатывается.
* Если в справочнике будут обнаружены дублирующие коды полномочий, которых нет в xml-файле, код полномочий будет помечен флагом `*Отменён*`.
* По кодам из XML-файла, которых нет в локальном справочнике будут созданы _Коды полномочий_ каждой имеющейся группы.
* Если в XML-файле будут обнаружены коды полномочий, которых нет в локальном справочнике, в справочник будут импортированы соответствующие полномочия.
+
. По завершении импорта появится информационное окно с результатом:
+
* При успешном импорте отобразится список групп, в которые были загружены коды.
* Если соответствий полномочиям из XML не найдено, будет отображено сообщение: `Ни одна из записей не была импортирована`.
* Если в XML будут обнаружены только уже имеющиеся в локальном справочнике полномочия, будет отображено сообщение: `Все доступные полномочия уже имеются в справочнике`.
+
. После обновления страницы в справочнике будут отображены созданные новые записи с заполненными полями значений кодов полномочий, мнемоники, названия, описания, датами создания и обновления.

[#new-code]
=== Добавление нового кода полномочий

Добавить новый код полномочий можно, выбрав в контекстном меню любого справочника команду _Создать код_, или выбрать справочник, нажать кнопку image:buttons/blue-plus.png[Белый плюс в синем круге].

.Создание нового кода полномочий
image::new-code.png[Создание нового кода полномочий]

При добавлении кода появится окно с доступными для заполнения полями:

. _Код полномочий_ -- уникальный код полномочий. Поле обязательно для заполнения.
. _Мнемоника полномочия_ -- мнемоника полномочия в реестре полномочий. Необязательное поле, может совпадать со значением _Кода полномочий_. Значения _Кода_ и _Мнемоники_ полномочий должны быть уникальными.
. _Название кода полномочий_ -- название полномочия. Поле обязательно для заполнения.
. _Описание_ -- подробное описание кода полномочий.
// . _Доверитель_ -- это физическое лицо, ИП или юридическое лицо, предоставившее полномочия. Поле обязательно для заполнения.

.Информация о коде полномочий
image::code-info.png[Информация о коде полномочий]

Когда в левой части выбран код полномочий, в правой части отображается информация о коде полномочий, включая два дополнительных поля, которые заполняются системой автоматически:

[start=5]
. _Дата создания_ -- дата создания кода.
. _Дата обновления_ -- дата обновления кода.

Информацию о коде полномочий можно изменить, выбрав код в списке слева и нажав кнопку image:buttons/blue-pencil.png[Белый карандаш в синем круге].

Коды полномочий не могут быть удалены, если они были использованы в карточке СКД через вызов API создания и передоверия МЧД. +
При попытке удалить такие коды полномочий будет выдано предупреждение `Невозможно удалить полномочия, т.к. данный код используется в сформированных МЧД`.

Если хотя бы один код в группе использовался в карточке СКД, при попытке удалить группу будет выдано предупреждение `Невозможно удалить справочник, т.к. он содержит полномочия, которые используются в сформированных МЧД`.

[#security]
== Настройки безопасности справочника

В зависимости от текущих прав доступа пользователя, справочник:

* Откроется в режиме просмотра, если пользователю запрещено редактирование справочника.
* Откроется в режиме редактирования, если пользователю разрешено редактирование справочника.
* Не откроется, и появится предупреждение об отсутствии прав доступа, если пользователь не имеет прав на просмотр справочника.

Администратор может задать права доступа для всего справочника при помощи элемента управления image:buttons/security.png[Замок], расположенного над правой областью, или из контекстного меню узла.

Настройка безопасности справочника полномочий xref:directories/staff/security.adoc[выполняется] по аналогии со справочником сотрудников.

[#select-powers]
== Выбор полномочий из справочника

Для выбора полномочий из справочника предназначен ЭУ "xref:layouts:ctrl/directories/powers.adoc[]". ЭУ должен быть добавлен в разметки карточек.